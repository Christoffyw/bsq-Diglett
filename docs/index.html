<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diglett: Diglett</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="151868295-0c690320-6333-4b74-90a6-c7003edb600f.png"/></td>
  <td id="projectalign">
   <div id="projectname">Diglett<span id="projectnumber">&#160;2.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Diglett </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p >Want to add localization to your Beat Saber mods? Don't wanna deal with the pain of using CSV and Polyglot? Then you should use Diglett</p>
<h1><a class="anchor" id="setup_sec"></a>
Setup</h1>
<p >The easiest way to load localization JSON and XML files, is using "Laurie's Fullyâ„¢-Functional Objcopy CMake Script". It can be found pinned in #quest-mod-dev in the BSMG. You can of course manually load the files from your ModData dir if you so wish, but I will not be going into that here.</p>
<p >Add the script to your CMakeLists.txt and include <code>assets.hpp</code> in your <code>main.cpp</code> file. (It doesnt matter if exists or not currently; it will be created when you build) Install Diglett with <code>qpm-rust dependency add diglett</code> and <code>qpm-rust restore</code></p>
<h1><a class="anchor" id="file_sec"></a>
Creating a Localization File</h1>
<p >First, create a folder in the root for your project called <code>assets/</code>. Localization files MUST be XML. XML can be much more useful on larger projects where annotation may be needed on some localizations.</p>
<p >To create an XML Localization File: Create a file in <code>assets/</code>. The filename should depend on what language the localization is in.</p>
<p >You will see a list of names for each language below:</p><ul>
<li><code>en.xm</code> - English</li>
<li><code>fr.xml</code> - French</li>
<li><code>es.xml</code> - Spanish</li>
<li><code>de.xml</code> - German</li>
<li><code>ja.xml</code> - Japanese</li>
<li><code>ko.xml</code> - Korean</li>
</ul>
<p >You do not need to follow this format but it is recommended to avoid confusion.</p>
<p >In each XML file, localizations should be formatted as such: </p><div class="fragment"><div class="line">&lt;resources&gt;</div>
<div class="line">   &lt;<span class="keywordtype">string</span> name=<span class="stringliteral">&quot;localizationKey&quot;</span>&gt;localization&lt;/<span class="keywordtype">string</span>&gt;</div>
<div class="line">   &lt;<span class="keywordtype">string</span> name=<span class="stringliteral">&quot;localizationKey2&quot;</span>&gt;localization2&lt;/<span class="keywordtype">string</span>&gt;</div>
<div class="line">&lt;/resources&gt;</div>
</div><!-- fragment --><p >XML files are great because they allow us to add additional data and comments without disrupting the actual localization. This can be useful in large collaborative projects, where clarity and communication between developers is important.</p>
<div class="fragment"><div class="line">&lt;resources&gt;</div>
<div class="line">   &lt;!-- Localization <span class="keywordflow">for</span> <span class="keyword">delete</span> button in each slogan --&gt;</div>
<div class="line">   &lt;<span class="keywordtype">string</span> name=<span class="stringliteral">&quot;Slogans:Buttons:Delete&quot;</span>&gt;Delete&lt;/<span class="keywordtype">string</span>&gt;</div>
<div class="line">&lt;/resources&gt;</div>
</div><!-- fragment --><p >When creating a localization key, I recommend using on eof the following formats:</p><ul>
<li><code>ModName:Group:Name</code> - E.g. <code>Diglett:Tests:Test</code> or</li>
<li><code>MODNAME_GROUP_NAME</code> - E.g. <code>DIGLETT_TESTS_TEST</code></li>
</ul>
<p >Please be consistent when naming keys and only use one format in your mod to avoid confusion.</p>
<h1><a class="anchor" id="register_sec"></a>
Registering Localization Files/Assets</h1>
<p >run <code>./build.ps1</code> Say we want to register our Localization Asset. Refer to the example below. </p><div class="fragment"><div class="line"><span class="comment">// Called later on in the game loading - a good time to install function hooks</span></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> load() {</div>
<div class="line">  il2cpp_functions::Init();</div>
<div class="line"> </div>
<div class="line">  getLogger().info(<span class="stringliteral">&quot;Registering locales&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  Diglett::RegisterAsset(ASSET_TO_STR(en_xml), Diglett::Language::ENGLISH);</div>
<div class="line"> </div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><p> We see that we register localization in our <code>load()</code> function. <code>RegisterAsset()</code> takes a <code>LocalizationAsset</code> and a <code>Language</code> as it's arguments. Whilst the <code>ASSET_TO_STR</code> macro does not construct a <code>LocalizationAsset</code>, the <code>string_view</code> it does return is implicitly converted to a <code>LocalizationAsset</code> instance.</p>
<h1><a class="anchor" id="getting_sec"></a>
Getting Localizations from Key</h1>
<p >There are two ways to get localizations from keys: With specific languages and with the selected language. </p>
<h2><a class="anchor" id="getting_spec_sec"></a>
Getting from Specific Languages</h2>
<p >We use the <code>Localization</code> class to get out string since it does basically everything. </p><div class="fragment"><div class="line"><span class="keyword">auto</span> localization = <a class="code hl_function" href="class_diglett_1_1_localization.html#a7bb01710586e9e39fb2594e1d2b97a5d">Diglett::Localization::get_instance</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> testText = localization-&gt;get(<span class="stringliteral">&quot;Diglett::Tests:Test&quot;</span>, Diglett::Language::English);</div>
<div class="ttc" id="aclass_diglett_1_1_localization_html_a7bb01710586e9e39fb2594e1d2b97a5d"><div class="ttname"><a href="class_diglett_1_1_localization.html#a7bb01710586e9e39fb2594e1d2b97a5d">Diglett::Localization::get_instance</a></div><div class="ttdeci">static Localization * get_instance()</div></div>
</div><!-- fragment --><p> NOTE: You should use the created string immediately due to the StringW being GCable. Storing it in a variable here is for purely demonstration purposes.</p>
<p >Specifying what language to use can be annoying and tedious. Realistically you want this to be handled automatically and for the selected language in Beat Saber to be used.</p>
<h2><a class="anchor" id="getting_auto_sec"></a>
Getting from Selected Language</h2>
<p >You could feed the previous <code>get()</code> method with <code>Diglett::getSelectedLanguage</code> but thats long. So instead you can just give <code>get()</code> the key and nothing else.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> localization = <a class="code hl_function" href="class_diglett_1_1_localization.html#a7bb01710586e9e39fb2594e1d2b97a5d">Diglett::Localization::get_instance</a>();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> testText = localization-&gt;get(<span class="stringliteral">&quot;Diglett::Tests:Test&quot;</span>);</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
